nextflow_pipeline {

    name "Test nf-core-utils color formatting error messages"
    script "../error-test.nf"
    config "../nextflow.config"

    test("Error output - Monochrome") {

        when {
            params {
                monochrome_logs = true
            }
        }

        then {
            assert workflow.failed

            assert snapshot(
                filterNextflowOutput(workflow.stdout + workflow.stderr, keepAnsi: true)
            ).match()
        }
    }

    test("Error output - Color") {

        when {
            params {
                monochrome_logs = false
            }
        }

        then {
            assert workflow.failed

            assert snapshot(
                filterNextflowOutput(workflow.stdout + workflow.stderr, keepAnsi: true)
            ).match()
        }
    }
}
